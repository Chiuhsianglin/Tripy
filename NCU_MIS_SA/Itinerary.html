<!DOCTYPE html>
<html lang="en">
<head>
	<title>tripy</title>
	<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
<!--===============================================================================================-->	
	<link rel="icon" type="image/png" href="images/icons/favicon.png"/>
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
<!--===============================================================================================-->	
	<link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/slick/slick.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/MagnificPopup/magnific-popup.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="css/util.min.css">
<!--===============================================================================================-->	
	<link rel="stylesheet" type="text/css" href="css/main.css">
<!--===============================================================================================-->
</head>
<body class="animsition">

	<!-- Header -->
	<header>
		<!-- Header desktop -->
		<nav class="container-header-desktop">
			<div class="wrap-menu-desktop">
				<div class="limiter-menu-desktop container">					
					<!-- Logo desktop -->		
					<div class="logo">
						<a href="index.html"><img src="images/icons/newlogo.png" alt="LOGO"></a>
					</div>

					<!-- Menu desktop -->
					<div class="menu-desktop">
						<ul class="main-menu respon-sub-menu">
							<li>
								<a href="tripy-City.html" style="font-weight: bold;">景點</a>
							</li>

							<li>
								<a href="tripy-StartPlanning.html" style="font-weight: bold;">觀光行程</a>
							</li>

							<li>
								<a href="tripy-FavoriteList.html" style="font-weight: bold;">我的收藏</a>
							</li>

							<li>
								<a href="tripy-login.html" style="font-weight: bold;">登入</a>
								<ul class="sub-menu bold-chinese-text">
									<li><a href="tripy-SeeAllMember.html">檢視所有會員</a></li>
									<li><a href="tripy-SeeAllAdmin.html">檢視所有管理員</a></li>
									<li><a href="tripy-AddAdmin.html">新增管理員</a></li>
								</ul>
							</li>
						</ul>
					</div>					
				</div>
			</div>	
		</nav>
		<style>
            .bold-chinese-text {
                font-family: '微軟正黑體', sans-serif;
                font-weight: bold; 
            }
            
            .item-cmt {
            padding-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 30px;
            margin-bottom: 20px;
            }

            .item-cmt:last-child {
            border: 1px solid #ccc;
            }

            .cmt-pic {
            width: 80px;
            height: 80px;
            overflow: hidden;
            }

            .cmt-pic img {
            width: 100%;
            height: auto;
            }
            .img-container {
                width: 450px;
                height: 70px;
                overflow: hidden;
            }

            .img-container img {
                width: 100%;
                height: auto;
            }

            .img-container2 {
                width: 350px;
                height: 70px;
                overflow: hidden;
            }

            .img-container2 img {
                width: 100%;
                height: auto;
            }

            .size-a-1 {
                min-width: 450px;
                height: 40px;
            }
            .size-a-2 {
                min-width: 300px;
                height: 40px;
            }
            .borderOne{
                border-radius: 30px;
            }

            .flex-row {
                display: flex;
                flex-direction: row;
                align-items: center; /* 可选，用于在垂直方向上居中 */
            }

            .size-a-100 {
                width: 130px;
                height: 40px;
            }

            .size-a-101 {
                width: 250px;
                height: 40px;
            }

            .size-a-102 {
                width: 80px;
                height: 40px;
            }
            .bo-tbl-1{
                border-left: 1px solid;
                border-bottom: 1px solid;
                border-top: 1px solid;
                border-right: 1px solid;
                border-color: #16a086;
            }

        </style>

	</header>

	<!-- Content -->
	<div class="bg-0 p-b-70">
		<div class="container">
			<div class="row justify-content-center">
				<div class="col-sm-10 col-md-4 col-lg-5 p-b-30">
                    <div class="col-sm-6 col-lg-5 p-b-10 isotope-item self " style="width: 100%">
                        <div id="Back"class="bg-0 h-full">
                            <div id="ItineraryLabel" onclick="back()" class="d-inline-flex flex-row-c-c size-a-1 p-rl-15 t1-s-2 text-uppercase cl-0 bg-11 hov-btn1 trans-02">
                                <i class="fs-14 cl-0 fa fa-chevron-left m-r-2"></i>
                                台南好好玩
                            </div>
                         
                            <form class="flex-wr-c-c size-a-2">
                                <button id="button" onclick="selectedDate()" class="size-a-22 fs-18 cl-0 bg-11">
                                    <i class="fa fa-calendar-check-o"></i>
                                </button>
                                <input id="selectedDate" class="swal-input size-a-21 bg-none t1-s-5 cl-6 plh-6 bo-tbl-1 p-rl-20" type="date">
                            </form>
                        </div>
                    </div>
					<!-- Left bar -->
                    <div id="ItineraryTable" class="p-b-30 p-l-15" style="width: 100%; height: 400px; overflow: auto;">
                        <div class="item-cmt main-cmt flex-wr-sb-s bcl-07">
                            <div class="cmt-pic m-b-2 p-t-20 p-l-10">
                                <img src="images/南機場夜市.jpg" alt="IMG">
                            </div>

                            <div class="cmt-text">
                                <div class="p-r-20 p-t-15">
									<i class="fs-14 cl-11 fa fa-calendar m-r-2"></i>

									<span class="t1-s-2 cl-11 ">
										2023/12/4
									</span>
								</div>
                                <div class="bold-chinese-text p-t-5">
                                    <p class="t1-s-2 cl-3">
                                        南機場夜市
                                    </p>
                                </div>
                                <div class="bold-chinese-text p-t-5">
                                    <p class="t1-s-1 cl-5">
                                        台北市中正區中華路二段307巷
                                    </p>
                                </div>
                                
                            </div>
                        </div>
                       
                  
                    </div>    
                        
                    </div>        
                        
                        
                    <div class="col-sm-10 col-md-4 col-lg-3 p-b-30">
					<!-- 搜尋 -->
					<div>
						<!-- Search -->
						<form class="flex-wr-c-c m-b-45">
							<input class="size-a-21 bg-none t1-s-5 cl-6 plh-6 bo-tbl-1 bcl-11 p-rl-20" type="text" name="search" placeholder="搜尋...">

							<button class="size-a-22 fs-18 cl-0 bg-11 hov-btn1 trans-02">
								<i class="fa fa-search"></i>
							</button>
						</form>
					</div>
                    <div class="p-b-30 " style="width: 100%; height: 440px; overflow: auto;">
                        <div class="item-cmt main-cmt flex-wr-sb-s bcl-07">
                            <div class="cmt-pic m-b-2 p-t-20 p-l-10">
                                <img src="images/南機場夜市.jpg" alt="IMG">
                            </div>

                            <div class="cmt-text">
                                <div class="bold-chinese-text p-t-25">
                                    <p class="t1-s-2 cl-3">
                                        南機場夜市
                                    </p>
                                </div>
                                <div class="bold-chinese-text p-t-5">
                                    <p class="t1-s-1 cl-5">
                                        台北市中正區中華路二段307巷
                                    </p>
                                </div>

                            </div>
                        </div>
                        
                    </div>
				</div>
				<!-- 收藏 -->
				
                <div class="col-sm-10 col-md-4 col-lg-4 p-b-30">
                    <div class="col-sm-6 col-lg-5 p-b-10 isotope-item self ">
                        <div class="flex-row" style="width: 380px">
                            <span class="size-w-0 p-l-15 bold-chinese-text">
                                <span class="fs-14 cl-5">
                                    <i class="fa fa-heart"></i>
                                </span>
                                <span>
                                    收藏
                                </span>
                            </span>

                            <div class="col-sm-6">
                                <div class="rs1-select2 bor9 bg0 ">
                                    <select id="SelectCL" onchange="handleSelectChange()" class="js-select2 size-a-102 bo-all-1 bcl-11 t1-m-2 plh-6 p-rl-20 w-full-sr575 m-b-10 " name="sex">

                                    </select>
                                    <div class="dropDownSelect2"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="Collection_panel" class="p-b-30 p-l-15" style="width: 100%; height: 460px; overflow: auto;">
                        
         
                    </div>
				</div>
			</div>
		</div>
	</div>
	
	<!--JS-->
	<script>
		var url_string = window.location.href;
  		var url = new URL(url_string);
        var user_id = url.searchParams.get("user_id");
        var list_id = url.searchParams.get("ItineraryList_id");

		//透過user_id取得CL
		function getAllCL(id) {
        // 發出POST的GET請求取得所有會員列表
        $.ajax({
          type: "GET", //注意！！
          url: "http://localhost:8090/NCU_MIS_SA/api/Collect_List.do",
          crossDomain: true,
          cache: false,
          dataType: "json",
          data: "user_id=" + user_id,        
          timeout: 10000,
          success: function (response) {
            if (response.status == 200) {
              updateCLTable(response.response.data);
            }
          },
          error: function () {
            alert("無法連線到伺服器！");
          },
        });
      }

      getAllCL(user_id);

      // 更新收藏清單表格
      function updateCLTable(data) {
        $("#SelectCL").empty();
        var collectlist_html = "<option>收藏清單</option>";
        $.each(data, function (index, value) {
			
			collectlist_html += '<option value="' +value["id"]+ '">'+ value["name"] + "</option>"
	
        });

        $("#SelectCL").append(collectlist_html);
      }

      function getAllItineraryItem() {
        // 發出POST的GET請求取得所有行程清單中的行程
        $.ajax({
          type: "GET", //注意！！
          url: "http://localhost:8090/NCU_MIS_SA/api/ItineraryItem.do",
          crossDomain: true,
          cache: false,
          dataType: "json",
          data: "list_id=" + list_id,        
          timeout: 10000,
          success: function (response) {
            if (response.status == 200) {
              updateIITable(response.response.data);
            }
          },
          error: function () {
            alert("無法連線到伺服器！");
          },
        });
      }

      getAllItineraryItem();

      function updateIITable(data) {
        $("#ItineraryTable").empty();
        var Itinerary_html = "";
        $.each(data, function (index, value) {
			Itinerary_html += '<div class="item-cmt main-cmt flex-wr-sb-s bcl-07">'
            Itinerary_html += '<div class="cmt-pic m-b-2 p-t-20 p-l-10">'
            Itinerary_html += '<img src="images/'+ value.scene.name +'.jpg" alt="IMG">'
            Itinerary_html += '</div>'
            Itinerary_html += '<div class="cmt-text">'
            Itinerary_html += '<div class="p-r-20 p-t-15">'
            Itinerary_html += '<i class="fs-14 cl-11 fa fa-calendar m-r-2"></i>'
            Itinerary_html += '<span class="t1-s-2 cl-11 ">'
            Itinerary_html += value.date
            Itinerary_html += '</span></div><div class="bold-chinese-text p-t-5"><p class="t1-s-2 cl-3">'
            Itinerary_html += value.scene.name
            Itinerary_html += '</p></div><div class="bold-chinese-text p-t-5"><p class="t1-s-1 cl-5">'
            Itinerary_html += value.scene.address
            Itinerary_html += '</p></div></div></div>'
        });

        $("#ItineraryTable").append(Itinerary_html);
      }

    //   function updateDateTable(data) {
    //     $("#ItineraryTable").empty();
    //     var Itinerary_html = "";

    //     // 取得當前日期
    //     var currentDate = new Date();

    //     // 格式化日期（YYYY-MM-DD）
    //     var formattedDate = currentDate.toISOString().split('T')[0];

    //     // 設定日期輸入框的值
    //     document.getElementById('selectedDate').value = formattedDate;

    //     // 獲取選取的日期
    //     var selectedDate = document.getElementById('selectedDate').value;

    //     $.each(data, function (index, value) {
    //         // 檢查日期是否與選取日期相符
    //         if (value.date === selectedDate) {
    //             Itinerary_html += '<div class="item-cmt main-cmt flex-wr-sb-s bcl-07">';
    //             Itinerary_html += '<div class="cmt-pic m-b-2 p-t-20 p-l-10">';
    //             Itinerary_html += '<img src="images/' + value.scene.name + '.jpg" alt="IMG">';
    //             Itinerary_html += '</div>';
    //             Itinerary_html += '<div class="cmt-text">';
    //             Itinerary_html += '<div class="p-r-20 p-t-15">';
    //             Itinerary_html += '<i class="fs-14 cl-11 fa fa-calendar m-r-2"></i>';
    //             Itinerary_html += '<span class="t1-s-2 cl-11 ">';
    //             Itinerary_html += value.date;
    //             Itinerary_html += '</span></div><div class="bold-chinese-text p-t-5"><p class="t1-s-2 cl-3">';
    //             Itinerary_html += value.scene.name;
    //             Itinerary_html += '</p></div><div class="bold-chinese-text p-t-5"><p class="t1-s-1 cl-5">';
    //             Itinerary_html += value.scene.address;
    //             Itinerary_html += '</p></div></div></div>';
    //         }
    //     });

    //     // 將結果顯示在 ItineraryTable 中
    //     $("#ItineraryTable").append(Itinerary_html);
    // }


    //     function selectedDate(){
    //         $.ajax({
    //             type: "GET", //注意！！
    //             url: "http://localhost:8090/NCU_MIS_SA/api/ItineraryItem.do",
    //             crossDomain: true,
    //             cache: false,
    //             dataType: "json",
    //             data: "list_id=" + list_id,        
    //             timeout: 10000,
    //             success: function (response) {
    //                 if (response.status == 200) {
    //                     updateDateTable(response.response.data);
    //                 }
    //             },
    //             error: function () {
    //                 alert("無法連線到伺服器！");
    //             },
    //         });
    //     }

        function selectedDate() {
        // 獲取選取的日期
        var selectedDate = document.getElementById('selectedDate').value;

        // 發送 HTTP 請求到後端 API
        $.ajax({
            type: "GET",
            url: "http://localhost:8090/NCU_MIS_SA/api/ItineraryItem.do",
            crossDomain: true,
            cache: false,
            dataType: "json",
            data: "list_id="+ list_id,
             //   selectedDate: selectedDate  // 將選取的日期作為參數傳遞給後端
            timeout: 10000,
            success: function (response) {
                if (response.status == 200) {
                    updateNewIITable(response.response.data);
                }
            },
            error: function () {
                alert("無法連線到伺服器！");
            },
        });
    }

    function updateNewIITable(data) {
        // 清空表格
        $("#ItineraryTable").empty();

        var Itinerary_html = "";
        var promises = [];

        $.each(data, function (index, value) {
            var ajaxPromise = $.ajax({
                type: "GET",
                url: "http://localhost:8090/NCU_MIS_SA/api/ItineraryList.do",
                data: {
                    "user_id": user_id,
                    "id": list_id
                },
                crossDomain: true,
                cache: false,
                dataType: "json",
                timeout: 10000
            }).then(function (response) {
                if (response.status == 200) {
                    // 這裡加入創建行程表格的程式碼
                    var itineraryDate = new Date(value.date);
                    var startDate = new Date(response.response.data.collect_List_info.start);
                    var endDate = new Date(response.response.data.collect_List_info.end);
                    // 檢查日期是否在 start 和 end 之間
                    if (itineraryDate >= startDate && itineraryDate <= endDate) {
                        Itinerary_html += '<div class="item-cmt main-cmt flex-wr-sb-s bcl-07">';
                        // ... (其他行程表格的 HTML 組成)
                    }
                }
            });

            promises.push(ajaxPromise);
        });

        // 等待所有的 AJAX 請求完成
        $.when.apply($, promises).then(function () {
            // 所有的 AJAX 請求都已經完成，將新的行程表格添加到 #ItineraryTable
            $("#ItineraryTable").append(Itinerary_html);
        }).fail(function () {
            alert("無法連線到伺服器！");
        });
    }


    // function updateNewIITable(data) {
    //     // 清空表格
    //     $("#ItineraryTable").empty();

    //     var Itinerary_html = "";
    //     $.each(data, function (index, value) {
    //         $.ajax({
    //         type: "GET", //注意！！
    //         url: "http://localhost:8090/NCU_MIS_SA/api/ItineraryList.do",
    //         data: {
    //             "user_id": user_id,
    //             "id": list_id
    //             },
    //         crossDomain: true,
    //         cache: false,
    //         dataType: "json",
    //         timeout: 10000,
    //         success: function (response) {
    //             if (response.status == 200) {
    //                 // 這裡加入創建行程表格的程式碼
    //                 var itineraryDate = new Date(value.date);
    //                 var startDate =new Date(response.response.data.collect_List_info.start);
    //                 var endDate =new Date(response.response.data.collect_List_info.end);
    //                 // 檢查日期是否在 start 和 end 之間
    //                 if (itineraryDate >= startDate && itineraryDate <= endDate) {
    //                     Itinerary_html += '<div class="item-cmt main-cmt flex-wr-sb-s bcl-07">'
    //                     Itinerary_html += '<div class="cmt-pic m-b-2 p-t-20 p-l-10">'
    //                     Itinerary_html += '<img src="images/'+ value.scene.name +'.jpg" alt="IMG">'
    //                     Itinerary_html += '</div>'
    //                     Itinerary_html += '<div class="cmt-text">'
    //                     Itinerary_html += '<div class="p-r-20 p-t-15">'
    //                     Itinerary_html += '<i class="fs-14 cl-11 fa fa-calendar m-r-2"></i>'
    //                     Itinerary_html += '<span class="t1-s-2 cl-11 ">'
    //                     Itinerary_html += value.date
    //                     Itinerary_html += '</span></div><div class="bold-chinese-text p-t-5"><p class="t1-s-2 cl-3">'
    //                     Itinerary_html += value.scene.name
    //                     Itinerary_html += '</p></div><div class="bold-chinese-text p-t-5"><p class="t1-s-1 cl-5">'
    //                     Itinerary_html += value.scene.address
    //                     Itinerary_html += '</p></div></div></div>'
    //                 }
    //             }
    //         },
    //         error: function () {
    //             alert("無法連線到伺服器！");
    //         },
    //         });
    //     });

    //     // 將新的行程表格添加到 #ItineraryTable
    //     $("#ItineraryTable").append(Itinerary_html);
    // }

        // function getItineraryDate() {
        //     $.ajax({
        //     type: "GET", //注意！！
        //     url: "http://localhost:8090/NCU_MIS_SA/api/ItineraryList.do",
        //     data: {
        //         "user_id": user_id,
        //         "id": list_id
        //         },
        //     crossDomain: true,
        //     cache: false,
        //     dataType: "json",
        //     timeout: 10000,
        //     success: function (response) {
        //         if (response.status == 200) {
        //             response.response.data.collect_List_info.start - response.response.data.collect_List_info.end;
        //         }
        //     },
        //     error: function () {
        //         alert("無法連線到伺服器！");
        //     },
        //     });
        // }

        
		
      function handleSelectChange() {
        var selectedId = document.getElementById("SelectCL").value;
        getCLItem(selectedId);
      }

	  function getCLItem(id) {
        // 發出POST的GET請求取得所有收藏清單內容(id=CL_id)
        $.ajax({
          type: "GET", //注意！！
          url: "http://localhost:8090/NCU_MIS_SA/api/collectionItem.do",
          crossDomain: true,
          cache: false,
          dataType: "json",
          data: { list_id: id },
          timeout: 10000,
          success: function (response) {
            if (response.status == 200) {
              var Collection_panel = "";
              $.each(response.response.data, function (u, v){
                    Collection_panel += addCollectionByCLId(v);
                    
                })
            
                $("#Collection_panel").empty();
                $("#Collection_panel").append(Collection_panel);
                    
            }
            },
          error: function () {
            alert("無法連線到伺服器！");
          },
        });
      }
      
      function addCollectionByCLId(data) {
			let inner_html = '';

            inner_html += '<div class="item-cmt main-cmt flex-wr-sb-s bcl-07">';
            inner_html += '<div class="cmt-pic m-b-2 p-t-20 p-l-10">';
            inner_html += '<img src="images/'+data.scene.name+'.jpg" alt="IMG">';
            inner_html += '</div>';
            inner_html += '<div class="cmt-text">';	
            inner_html += '<div class="bold-chinese-text p-t-25">';
            inner_html += '<p class="t1-s-2 cl-3">'+data.scene.name+'</p>';
            inner_html += '</div>';
            inner_html += '<div class="bold-chinese-text p-t-5">';
            inner_html += '<p class="t1-s-1 cl-5">';
            inner_html += data.scene.address; //adress(還沒確認名稱)
            inner_html += '</p></div></div></div>';

			return inner_html;
		}

        function getItineraryLabel() {
            $.ajax({
            type: "GET", //注意！！
            url: "http://localhost:8090/NCU_MIS_SA/api/ItineraryList.do",
            data: {
                "user_id": user_id,
                "id": list_id
                },
            crossDomain: true,
            cache: false,
            dataType: "json",
            timeout: 10000,
            success: function (response) {
                if (response.status == 200) {
                updateItineraryLable(response.response.data);
                }
            },
            error: function () {
                alert("無法連線到伺服器！");
            },
            });
        }
        getItineraryLabel()

        function updateItineraryLable(data) {
            $("#ItineraryLabel").empty();
            var Itinerary_html = "";
                Itinerary_html += '<i class="fs-14 cl-0 fa fa-chevron-left m-r-2"></i>';
                Itinerary_html += data.collect_List_info.name;   

            $("#ItineraryLabel").append(Itinerary_html);
        }

	</script>
	
	<!-- Footer -->
	<footer>
		
	</footer>


<!--===============================================================================================-->	
	<script src="vendor/jquery/jquery-3.2.1.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/animsition/js/animsition.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/bootstrap/js/popper.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/select2/select2.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/parallax100/parallax100.js"></script>
<!--===============================================================================================-->
	<script src="vendor/waypoint/jquery.waypoints.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/countterup/jquery.counterup.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/slick/slick.min.js"></script>
	<script src="js/slick-custom.js"></script>
<!--===============================================================================================-->
	<script src="vendor/MagnificPopup/jquery.magnific-popup.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/isotope/isotope.pkgd.min.js"></script>
<!--===============================================================================================-->
	<script src="js/main.js"></script>

</body>
</html>